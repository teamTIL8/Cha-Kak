<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>회원가입</title>
	<link rel="stylesheet" href="/css/style.css">
</head>

<body>
	<div class="container">
		<h1>회원가입</h1>
		<form id="signupForm" method="post">
			<div class="form-group">
				<label for="userId">사용자 ID:</label>
				<input type="text" id="userId" name="userId" required>
			</div>
			<div class="form-group">
				<label for="email">이메일:</label>
				<input type="email" id="email" name="email" required>
			</div>
			<div class="form-group">
				<label for="password">비밀번호:</label>
				<input type="password" id="password" name="password" required>
			</div>
			<div class="form-group">
				<label for="name">이름:</label>
				<input type="text" id="name" name="name" required>
			</div>
			<button type="submit" class="button">회원가입</button>
		</form>
		<p id="message" class="error-message"></p>
		<p>이미 계정이 있으신가요? <a href="/login">로그인</a></p>
	</div>

	<script>
		document.getElementById('signupForm').addEventListener('submit', async function (event) {
			event.preventDefault(); // 기본 폼 제출 방지

			const userId = document.getElementById('userId').value;
			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;
			const name = document.getElementById('name').value;
			const messageElement = document.getElementById('message');

			try {
				const response = await fetch('/api/auth/signup', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({userId, email, password, name})
				});

				if (response.ok) {
					messageElement.className = 'success-message';
					messageElement.textContent = '회원가입이 성공적으로 완료되었습니다! 로그인 페이지로 이동합니다.';
					setTimeout(() => {
						window.location.href = '/login';
					}, 2000); // 2초 후 로그인 페이지로 리다이렉트
				} else if (response.status === 400) {
					const errorMessage = await response.text(); // 서버에서 보낸 에러 메시지
					messageElement.className = 'error-message';
					messageElement.textContent = errorMessage || '이미 존재하는 이메일입니다.';
				} else {
					messageElement.className = 'error-message';
					messageElement.textContent = '회원가입 중 오류가 발생했습니다. 다시 시도해주세요.';
				}
			} catch (error) {
				console.error('Error during signup:', error);
				messageElement.className = 'error-message';
				messageElement.textContent = '네트워크 오류가 발생했습니다.';
			}
		});
	</script>
</body>

</html>